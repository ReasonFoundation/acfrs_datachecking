---
title: "Tables & Plots for Reporting Purposes"
output: html_document
---

Can you add the following to the script:

1.       State, Entity Name, Total Liabilities, Total Revenue and Total Liabilities/Total Revenue Ratio for all 50 states and the District of Columbia.

2.       State, Entity Name, Total Liabilities, Total Revenue and Total Liabilities/Total Revenue Ratio for the 100 highest population cities in our data

3.       State, Entity Name, Total Liabilities, Total Revenue and Total Liabilities/Total Revenue Ratio for the 100 highest population counties in our data

4.       State, Entity Name, Total Liabilities, Total Revenue and Total Liabilities/Total Revenue Ratio for the 100 highest enrollment school districts in our data

---------
Some feedback:

Can you format call numbers with thousand separators
For all reports please show the liability-to-revenue ratio as a percentage
The state list is not what I was hoping for.  This should be data for the ACFRs produced by each US State.  You can isolate the state ACFRs by looking for the strings “State of “ or “Commonwealth of “ at the beginning of the entity name, and checking the remainder of the entity name against a list of US states.
For cities, you should do a name match against a list of cities from the Census.  If querying the Census data directly is a problem, you could use the table in Wikipedia to get started:  https://en.wikipedia.org/wiki/List_of_United_States_cities_by_population.  To get matches you may need to remove strings like “City of “ and “Town of  “ from our entity names.
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(kableExtra)

acfrs <- readRDS("data_from_dbsite.RDS")
matched_acfrs_nces_sd <- readRDS("matched_acfrs_nces_sd.RDS")
county_pop_census_acfrs <- readRDS("county_pop_census_acfrs.RDS")
```
# State, Entity Name, Total Liabilities, Total Revenue and Total Liabilities/Total Revenue Ratio for all 50 states and the District of Columbia.


```{r}
all_states <- acfrs %>% 
  select(state, name, total_liabilities, revenues, total_liabilities/revenues) 

kable(head(all_states, 10), "html") %>%
kable_styling() %>%
scroll_box(height = "500px", width = "800px")
```

# State, Entity Name, Total Liabilities, Total Revenue and Total Liabilities/Total Revenue Ratio for the 100 highest population counties in our data

```{r}
top100_pop <- county_pop_census_acfrs %>% select(state.abb, county, total_liabilities, revenues, total_liabilities/revenues, population) %>% 
  arrange(desc(population)) %>% slice(1:100)

kable(top100_pop, "html") %>%
kable_styling() %>%
scroll_box(height = "500px", width = "800px")
```


# State, Entity Name, Total Liabilities, Total Revenue and Total Liabilities/Total Revenue Ratio for the 100 highest enrollment school districts in our data
```{r}
top100_student <- matched_acfrs_nces_sd %>% select(state, acfrs_original_name, total_liabilities, revenues, total_liabilities/revenues, student) %>% 
  arrange(desc(student)) %>% slice(1:100)

kable(top100_student, "html") %>%
kable_styling() %>%
scroll_box(height = "500px", width = "800px")
```